{% extends "base.html" %}
{% load static %}

{% block page_title %}
    Home
{% endblock %}

{% block content %}

    <div class="flex flex-wrap">
        <div>
            {% for user in users %}
                <div class="flex flex-wrap m-4 p-4 rounded shadow items-center">
                    {% if user.avatar != '' %}
                        {# <div class="w-9 h-12 bg-cover bg-center" style="background-image: url(media/{{ user.avatar }})"></div> #}
                        <img style="width: 100px; height: 100px;"  src="{{ user.avatar.url }}" class="object-cover object-center rounded-full"/>
                    {% else %}
                        <img style="width: 100px; height: 100px;" src="{% static 'img/blank_profile.png' %}" class="object-cover object-center rounded-full"/>
                    {% endif %}

                    <div class="flex flex-col w-full px-4 max-w-lg">
                        <a href="{% url "users:detail" user.pk %}" class="flex flex-col font-medium pb-2">
                            <span>{{ user.last_name }}{{ user.first_name }}</span>
                            <span>{{ user.username }} ></span>
                        </a>

                        {{ user.bio }}
                        {% if user.is_soldier == True and user.mil_start != None and user.mil_fin != None %}
                            🪖군 복무 중
                            <div>
                                {{ user.mil_start|date:'입영일 Y.m.d' }}
                                {{ user.mil_fin|date:'전역일 Y.m.d' }}
                                전역까지 {{ user.mil_fin|timeuntil }}
                                (D-{{ user.mil_left_date }})
                                {{ user.mil_percentage }}% 수료.
                                <svg viewBox="0 0 100 3" xmlns="http://www.w3.org/2000/svg">
                                    <!-- No dashes nor gaps -->
                                    <line x1="0" y1="1" x2="100" y2="1" stroke="lightgray"/>
                                    <line x1="0" y1="1" x2="{{ user.mil_percentage }}" y2="1" stroke="rgb(23, 168, 201)"/>
                                </svg>
                            </div>
                        {% endif %}
                        {% if user.homepage != None %}
                            <a href={{ user.homepage }}>HomePage ></a>
                        {% endif %}
                        {% if user.blog != None %}
                            <a href={{ user.blog }}>Blog ></a>
                        {% endif %}

                        {% if user.birthdate|date:"md" == today|date:"md" %}
                            <b>🥳 오늘 생일 🎂</b>
                        {% endif %}
                    </div>

                    {% comment %}
                        // {% now "md" %}
                        {% if date_created|date:"YmdHis" < now|date:"YmdHis" %}
                        {% endif %}
                    {% endcomment %}
                </div>

            {% endfor %}
        </div>

        <div>
            {% if user.is_authenticated %}
                <div class="w-full">
                    <div class="m-4 p-4 rounded shadow">

                        <p class="font-medium text-lg pb-2">Recent Posts</p>
                        {% for post in recent_posts %}
                            <div class="flex items-center">
                                {% if post.user == request.user %}
                                    <i class="fas fa-user text-gray-400 text-xs pr-1.5"></i>
                                {% endif %}

                                <p class="flex items-center justify-between w-full">
                                    <a href="{% url "posts:detail" post.pk %}" class="text-sm">
                                        <span class="w-9/12 block truncate">{{ post.title }}</span>
                                    </a>
                                    <span class="w-16 flex items-center justify-between text-mint font-medium text-sm">
                                        <i class="fas fa-arrows-alt-v"></i>
                                        {{ post.like_sum }}
                                        <i class="fas fa-comment"></i>
                                        {{ post.comments.count }}
                                    </span>
                                </p>

                                {% comment %}
                                {% if post.like_sum >= 4 %}
                                    WOW!
                                {% elif post.like_sum <= -4 %}
                                    So Sad...
                                {% else %}
                                    NORMAL!
                                {% endif %}

                                {% if post in request.user.like_posts.all %}
                                    내가 추천한 글!
                                {% endif %}

                                {% if today|date:"ymd" == post.created|date:"ymd" %}
                                    NEW!!
                                {% endif %}
                                {% endcomment %}
                            </div>
                        {% endfor %}
                    </div>

                    <div class="m-4 p-4 rounded shadow">
                        <p class="font-medium text-lg pb-2">Trending Posts</p>
                        {% for post in trending_posts %}
                            <p>
                                <a href="{% url "posts:detail" post.pk %}" class="text-sm">
                                    {{ post.title }} 추천{{ post.like_sum }} 댓글{{ post.comments.count }}
                                </a>
                            </p>
                        {% endfor %}
                    </div>

                </div>
            {% endif %}
        </div>
    </div>

{% endblock content %}

